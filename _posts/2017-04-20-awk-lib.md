---
title: Awk libs
updated: 2017-04-20 18:00
---

这个lib不是awk自带的，而是通过awk封装的一些常用操作

## Color

使用tput命令设置颜色，将值读取到数组中

```awk
function set_color(array){
    #bold
    cmd = "tput bold";
    cmd | getline array["bold"];
    close(cmd)
    
    # color_name
    split("black red green yellow blue magenta cyan white", color_array)
    for(i = 0; i<length(color_array);i++){
        cmd = "tput setaf " i
        cmd | getline array[color_array[i+1]]
        close(cmd)    
    }

    cmd = "tput sgr0"
    cmd | getline array["reset"];
    close(cmd)
}
```

使用则为：

```awk

@include "colors.awk"

BEGIN{
    
    set_color(colors);
    
    print colors["red"] "red\t", colors["bold"] "bold red" colors["reset"];  
}

```


## Profiling

first we need to insert some the count statement in the target file

```awk
#makeprof
/{/  sub({, "{ _LBcnt[" ++_numLB "]++; ")
print

END {
    printf("END {for (i=1; i<= %d; i++)\n}", _numLB)
    printf("\t\t print _LBcnt[i] > \"prof.cnts\"\n}\n")    
}
```

注意sub这个函数会对每行都执行，即使匹配不到也会对变量进行操作(_numLB总是会被自增)，所以可以先用正则匹配下。

接下来是统计执行测试并将结果打印出来

```awk
#printprof
BEGIN {while (getline < "prof.cnts" > 0) cnt[++i] = $1}

/{/ {printf("%5d",cnt[++j])}
    {printf("\t%s\n",$0)}

```

使用方式为：

```bash
awk -f makeprof target > target.p
awk -f target.p inputfile
awk -f printprof target
```

这样便可以看出执行的次数


