---
title: C Struct Use 
updated: 2015-11-15  22:30
---


## C Part

### Nest Struct

Today i read my colleague's code, I found he prefer to using struct in this way:

	typedef struct {
		int i;
		int j;
	}struct1;

	typedef struct{
		struct1 s1;
		int k;
	}struct2;

	struct2 *s2;
	... //malloc
	MarcoDefine(s2,othervar);
	//or MarcoDefine(&s2->s1,othervar);

Then the Marco is:

	#define MarcoDefine(s,t)  functioncall((struct1 *)s, t)

And then in function, That will make a another convert:

	functioncall(struct1 *s, int t){
		struct2 *st = (struct2 *)s;

		....
	}

Those codes worked really good. Do you find that is like the `OO` in C++ ? `struct1` is `parent class` and the `struct2` is `child class`. 


### Hash function 

In C, there are so many hash string functions to use. In [there](https://www.cs.hmc.edu/~geoff/classes/hmc.cs070.200101/homework10/hashfuncs.html)

And i found `djb` may easy to understand. 
	
	unsigned long
    hash(unsigned char *str)
    {
        unsigned long hash = 5381;
        int c;

        while (c = *str++)
            hash = ((hash << 5) + hash) + c; /* hash * 33 + c */

        return hash;
    }

The `5381` is a magic number, In stackoverflow, there is a question about this [number](http://stackoverflow.com/questions/10696223/reason-for-5381-number-in-djb-hash-function).  With the hash string function, we can reduce the cost when seaching string. 


 
## Links

[haoel's post about use oo in c](http://blog.csdn.net/haoel/article/details/2864)
[Wikipedia's introduction of hash function](https://en.wikipedia.org/wiki/Hash_function)
[Jenkins_hash_function](https://en.wikipedia.org/wiki/Jenkins_hash_function)




<embed src="http://music.163.com/style/swf/widget.swf?sid=125909811&type=0&auto=0&width=310&height=430" width="330" height="450"  allowNetworking="all">

